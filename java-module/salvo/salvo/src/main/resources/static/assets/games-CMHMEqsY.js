import{c as d,j as e,r as c,F as o,A as h}from"./styles-BqQF-a9h.js";function m(){const[l,n]=c.useState([]),[a,i]=c.useState("");c.useEffect(()=>{let s=!0;return fetch("/api/games").then(r=>{if(!r.ok)throw new Error(`Server error: ${r.status}`);return r.json()}).then(r=>{s&&n(Array.isArray(r)?r:[])}).catch(r=>{s&&i(r.message)}),()=>{s=!1}},[]);const t=c.useMemo(()=>j(l),[l]);return e.jsxs(e.Fragment,{children:[e.jsx(o,{}),e.jsxs(h,{title:"Salvo",subtitle:"Games & leaderboard",children:[e.jsxs("section",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Leaderboard"}),e.jsxs("span",{className:"tag",children:[t.length," players"]})]}),t.length===0?e.jsx("p",{className:"notice",children:"No completed games yet."}):e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Player"}),e.jsx("th",{children:"Wins"}),e.jsx("th",{children:"Losses"}),e.jsx("th",{children:"Ties"}),e.jsx("th",{children:"Points"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.email}),e.jsx("td",{children:s.wins}),e.jsx("td",{children:s.losses}),e.jsx("td",{children:s.ties}),e.jsx("td",{children:s.points.toFixed(1)})]},s.playerId))})]})]}),e.jsxs("section",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Games"}),e.jsxs("span",{className:"tag",children:[l.length," total"]})]}),a?e.jsx("p",{className:"notice",children:a}):null,e.jsx("div",{className:"game-list",children:l.map(s=>e.jsxs("article",{className:"game-row",children:[e.jsxs("strong",{children:["Game ",s.id]}),e.jsxs("div",{className:"game-meta",children:[e.jsx("span",{children:x(s.created)}),e.jsxs("span",{children:[(s.gamePlayers||[]).length," players"]})]}),e.jsx("div",{className:"game-players",children:(s.gamePlayers||[]).map(r=>e.jsx("a",{className:"link-button",href:`/web/game.html?gp=${r.id}`,children:r.player?.email||"Unknown"},r.id))})]},s.id))})]})]})]})}function x(l){if(!l)return"Unknown";const n=new Date(l);return Number.isNaN(n.getTime())?"Unknown":n.toLocaleString()}function j(l){const n=new Map;return l.forEach(a=>{(a.gamePlayers||[]).forEach(i=>{const t=i.player;t&&(n.has(t.id)||n.set(t.id,{playerId:t.id,email:t.email,wins:0,losses:0,ties:0}))}),(a.scores||[]).forEach(i=>{const t=i.player;if(!t||!n.has(t.id))return;const s=n.get(t.id),r=Number(i.score);r===1&&(s.wins+=1),r===0&&(s.losses+=1),r===.5&&(s.ties+=1)})}),Array.from(n.values()).map(a=>({...a,points:a.wins+a.ties*.5})).sort((a,i)=>i.points-a.points||i.wins-a.wins||a.losses-i.losses)}const p=d.createRoot(document.getElementById("root"));p.render(e.jsx(m,{}));
