import{c as g,j as e,r as h,A as x}from"./styles-D6TO0k75.js";const f=["A","B","C","D","E","F","G","H","I","J"],p=[1,2,3,4,5,6,7,8,9,10];function v(){const r=y(),[s,n]=h.useState(null),[i,a]=h.useState("");h.useEffect(()=>{if(!r)return;let l=!0;return fetch(`/api/game_view/${r}`).then(t=>{if(!t.ok)throw new Error(`Server error: ${t.status}`);return t.json()}).then(t=>{l&&n(t)}).catch(t=>{l&&a(t.message)}),()=>{l=!1}},[r]);const o=h.useMemo(()=>new Set(w(s)),[s]),{playerTurns:c,opponentTurns:d}=h.useMemo(()=>S(s),[s]);return e.jsx(x,{title:"Salvo",subtitle:"Game view",children:e.jsxs("section",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:b(s,r)}),s?e.jsxs("span",{className:"tag",children:["Game ",s.gameId]}):null]}),r?i?e.jsx("p",{className:"notice",children:i}):s?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid-wrap",children:[e.jsx(j,{title:"Your fleet",legend:e.jsxs("div",{className:"legend",children:[e.jsxs("span",{children:[e.jsx("i",{style:{background:"var(--ship)"}})," Ship"]}),e.jsxs("span",{children:[e.jsx("i",{style:{background:"var(--hit)"}})," Hit"]})]}),renderCell:l=>{const t=o.has(l),m=d.get(l),u=["cell"];return t&&m!==void 0?(u.push("hit"),{className:u.join(" "),label:String(m)}):t?(u.push("ship"),{className:u.join(" "),label:"S"}):{className:u.join(" "),label:""}}}),e.jsx(j,{title:"Your salvoes",legend:e.jsx("div",{className:"legend",children:e.jsxs("span",{children:[e.jsx("i",{style:{background:"var(--salvo)"}})," Fired"]})}),renderCell:l=>{const t=c.get(l);return t===void 0?{className:"cell",label:""}:{className:"cell salvo",label:String(t)}}})]})}):e.jsx("p",{className:"notice",children:"Loading game data..."}):e.jsx("p",{className:"notice",children:"Missing game player id. Use ?gp=1 in the URL."})]})})}function j({title:r,legend:s,renderCell:n}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:r})}),s,e.jsx(N,{renderCell:n})]})}function N({renderCell:r}){return e.jsxs("table",{className:"grid",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),p.map(s=>e.jsx("th",{children:s},s))]})}),e.jsx("tbody",{children:f.map(s=>e.jsxs("tr",{children:[e.jsx("th",{children:s}),p.map(n=>{const i=`${s}${n}`,a=r(i);return e.jsx("td",{className:a.className,children:a.label},i)})]},s))})]})}function y(){const s=new URLSearchParams(window.location.search).get("gp"),n=Number(s);return Number.isFinite(n)?n:null}function b(r,s){if(!r||!Array.isArray(r.gamePlayers))return"Awaiting game data";const n=r.gamePlayers.find(c=>c.id===s),i=r.gamePlayers.filter(c=>c.id!==s),a=n?.player?.email||"Unknown",o=i.map(c=>c.player?.email||"Unknown").join(" vs ");return o?`${a} (you) vs ${o}`:`${a} (you) - waiting for opponent`}function w(r){return!r||!Array.isArray(r.ships)?[]:r.ships.flatMap(s=>s.locations||[])}function S(r){const s=new Map,n=new Map;if(!r||!r.salvoes)return{playerTurns:s,opponentTurns:n};const i=String(r.gamePlayerId);return Object.entries(r.salvoes).forEach(([a,o])=>{E(o).forEach((d,l)=>{if(a===i)s.set(l,d);else{const t=n.get(l);(t===void 0||d<t)&&n.set(l,d)}})}),{playerTurns:s,opponentTurns:n}}function E(r){const s=new Map;return Object.entries(r||{}).forEach(([n,i])=>{const a=Number(n);!Array.isArray(i)||!Number.isFinite(a)||i.forEach(o=>{const c=s.get(o);(c===void 0||a<c)&&s.set(o,a)})}),s}const M=g.createRoot(document.getElementById("root"));M.render(e.jsx(v,{}));
